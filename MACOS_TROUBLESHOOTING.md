# macOS Digispark æ•…éšœæ’é™¤æŒ‡å—

## âŒ å•é¡Œï¼šmacOS ç„¡æ³•è­˜åˆ¥ Digispark éµç›¤

### å¸¸è¦‹ç—‡ç‹€
- æ’å…¥ Digispark å¾Œæ²’æœ‰ä»»ä½•åæ‡‰
- macOS ä¸é¡¯ç¤ºæ–°éµç›¤é€šçŸ¥
- Terminal æ²’æœ‰è‡ªå‹•é–‹å•Ÿ
- ç³»çµ±åå¥½è¨­å®šä¸­çœ‹ä¸åˆ°æ–°éµç›¤

---

## ğŸ” è¨ºæ–·æ­¥é©Ÿ

### 1. æª¢æŸ¥ USB è£ç½®æ˜¯å¦è¢«è­˜åˆ¥

```bash
# æŸ¥çœ‹ USB è£ç½®åˆ—è¡¨
system_profiler SPUSBDataType | grep -A 10 "Digispark\|ATtiny\|16c0\|16d0"

# æŸ¥çœ‹ USB æ—¥èªŒï¼ˆå¯¦æ™‚ï¼‰
log stream --predicate 'subsystem == "com.apple.iokit.IOUSBHostFamily"' --level debug
```

**é æœŸçµæœï¼š**
- æ‡‰è©²çœ‹åˆ° `Vendor ID: 0x16c0` æˆ– `0x16d0`
- Product ID å¯èƒ½æ˜¯ `0x27db` æˆ–é¡ä¼¼

### 2. æª¢æŸ¥å‡½å¼åº«ç›¸å®¹æ€§

| å‡½å¼åº« | macOS ç›¸å®¹æ€§ | Windows ç›¸å®¹æ€§ | Linux ç›¸å®¹æ€§ |
|--------|-------------|---------------|-------------|
| **DigiKeyboard** | âœ… å„ªç§€ | âœ… å„ªç§€ | âœ… å„ªç§€ |
| **TrinketHidCombo** | âš ï¸ æœ‰å•é¡Œ | âœ… å„ªç§€ | âœ… å„ªç§€ |

**åŸå› ï¼š**
- TrinketHidCombo çš„ USB æè¿°ç¬¦åœ¨ macOS ä¸Šå¯èƒ½ä¸è¢«å®Œå…¨æ”¯æ´
- macOS å° HID è£ç½®æœ‰æ›´åš´æ ¼çš„é©…å‹•æª¢æŸ¥

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ DigiKeyboard ç‰ˆæœ¬ï¼ˆæ¨è–¦ï¼‰

æˆ‘å·²ç¶“å»ºç«‹äº†ä½¿ç”¨ DigiKeyboard çš„ç‰ˆæœ¬ï¼š

```bash
cd ~/Developer/hw-018-keyboard-attack

# ç·¨è­¯ä¸¦ç‡’éŒ„ DigiKeyboard ç‰ˆæœ¬
./build_zipbomb_macos_digi.sh all
```

**å„ªé»ï¼š**
- âœ… macOS åŸç”Ÿæ”¯æ´æ›´å¥½
- âœ… ä¸éœ€è¦é¡å¤–é©…å‹•
- âœ… ç©©å®šæ€§æ›´é«˜

**å·®ç•°ï¼š**
- ä½¿ç”¨ `DigiKeyboard.h` è€Œé `TrinketHidCombo.h`
- API ç¨æœ‰ä¸åŒä½†åŠŸèƒ½ç›¸åŒ

### æ–¹æ¡ˆ 2ï¼šæª¢æŸ¥ macOS å®‰å…¨è¨­å®š

#### 2.1 åœç”¨ã€Œå®‰å…¨éµç›¤è¼¸å…¥ã€

æŸäº›æ‡‰ç”¨ç¨‹å¼ï¼ˆå¦‚ Terminalï¼‰å¯èƒ½å•Ÿç”¨äº†å®‰å…¨éµç›¤è¼¸å…¥ï¼š

```bash
# åœ¨ Terminal æ‡‰ç”¨ç¨‹å¼ä¸­ï¼š
# é¸å–®åˆ— â†’ Terminal â†’ å–æ¶ˆå‹¾é¸ã€Œå®‰å…¨éµç›¤è¼¸å…¥ã€
```

**æˆ–ä½¿ç”¨å‘½ä»¤ï¼š**
```bash
# æª¢æŸ¥æ˜¯å¦å•Ÿç”¨
ioreg -l -w 0 | grep SecureInput

# å¦‚æœè¼¸å‡ºæœ‰å…§å®¹ï¼Œè¡¨ç¤ºå·²å•Ÿç”¨ï¼Œéœ€è¦åœç”¨
```

#### 2.2 å…è¨±è¼”åŠ©åŠŸèƒ½å­˜å–

1. ç³»çµ±åå¥½è¨­å®š â†’ å®‰å…¨æ€§èˆ‡éš±ç§
2. éš±ç§ â†’ è¼”åŠ©åŠŸèƒ½
3. ç¢ºèª Terminal å’Œç›¸é—œæ‡‰ç”¨ç¨‹å¼æœ‰æ¬Šé™

#### 2.3 æª¢æŸ¥éµç›¤è¨­å®š

1. ç³»çµ±åå¥½è¨­å®š â†’ éµç›¤
2. ç¢ºèªã€Œä½¿ç”¨ F1ã€F2 ç­‰éµä½œç‚ºæ¨™æº–åŠŸèƒ½éµã€å·²å•Ÿç”¨ï¼ˆå¦‚æœéœ€è¦ï¼‰

### æ–¹æ¡ˆ 3ï¼šå¢åŠ å»¶é²æ™‚é–“

å¦‚æœ macOS éœ€è¦æ›´å¤šæ™‚é–“è­˜åˆ¥è£ç½®ï¼š

ç·¨è¼¯ `.ino` æª”æ¡ˆï¼Œå¢åŠ åˆå§‹å»¶é²ï¼š

```cpp
void setup() {
  DigiKeyboard.delay(3000);  // å¾ 2000 æ”¹ç‚º 3000
}
```

### æ–¹æ¡ˆ 4ï¼šæª¢æŸ¥ USB åŸ 

- å˜—è©¦ä¸åŒçš„ USB åŸ 
- é¿å…ä½¿ç”¨ USB Hub
- ä½¿ç”¨ USB 2.0 åŸ ï¼ˆè—è‰²çš„æ˜¯ USB 3.0ï¼‰

---

## ğŸ§ª æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1ï¼šåŸºæœ¬ USB è­˜åˆ¥æ¸¬è©¦

å»ºç«‹ç°¡å–®çš„æ¸¬è©¦ç¨‹å¼ï¼š

```cpp
#include "DigiKeyboard.h"

void setup() {
  DigiKeyboard.delay(2000);
}

void loop() {
  DigiKeyboard.print("TEST");
  DigiKeyboard.delay(5000);
}
```

**é æœŸçµæœï¼š**
- æ¯ 5 ç§’æ‡‰è©²è¼¸å…¥ "TEST"
- å¦‚æœçœ‹åˆ° "TEST"ï¼Œè¡¨ç¤ºè£ç½®å·²è¢«è­˜åˆ¥

### æ¸¬è©¦ 2ï¼šSpotlight æ¸¬è©¦

```cpp
#include "DigiKeyboard.h"

void setup() {
  DigiKeyboard.delay(2000);
}

void loop() {
  DigiKeyboard.sendKeyStroke(KEY_SPACE, MOD_GUI_LEFT);
  for(;;) {}
}
```

**é æœŸçµæœï¼š**
- æ‡‰è©²é–‹å•Ÿ Spotlight æœå°‹

### æ¸¬è©¦ 3ï¼šå®Œæ•´ Terminal æ¸¬è©¦

ä½¿ç”¨ `zipbomb_macos_digi.ino`

---

## ğŸ”§ é€²éšæ•…éšœæ’é™¤

### 1. é‡æ–°å®‰è£ Digistump é©…å‹•ï¼ˆå¦‚æœéœ€è¦ï¼‰

é›–ç„¶ macOS é€šå¸¸ä¸éœ€è¦é¡å¤–é©…å‹•ï¼Œä½†æŸäº›æƒ…æ³ä¸‹å¯èƒ½éœ€è¦ï¼š

```bash
# ä¸‹è¼‰ä¸¦å®‰è£ Digistump é©…å‹•
# åƒè€ƒ: http://digistump.com/wiki/digispark/tutorials/connecting
```

### 2. æª¢æŸ¥ Bootloader

ç¢ºèª Digispark ä¸Šçš„ bootloader æ­£å¸¸ï¼š

```bash
# ç‡’éŒ„æ™‚æ‡‰è©²çœ‹åˆ°ï¼š
# > Device: ATtiny85
# > Bootloader: Micronucleus 2.x
```

### 3. ä½¿ç”¨åŸå» æ¸¬è©¦ç¨‹å¼

å¾ Digistump å®˜æ–¹ä¸‹è¼‰æ¸¬è©¦ç¨‹å¼é©—è­‰ç¡¬é«”ï¼š

```bash
# Digispark å®˜æ–¹ Hello World ç¯„ä¾‹
#include "DigiKeyboard.h"

void setup() {}

void loop() {
  DigiKeyboard.sendKeyStroke(0);
  DigiKeyboard.println("Hello Digispark!");
  DigiKeyboard.delay(5000);
}
```

### 4. é‡ç½® NVRAM/PRAM

æœ‰æ™‚ macOS USB å­ç³»çµ±å¯èƒ½éœ€è¦é‡ç½®ï¼š

1. é—œæ©Ÿ
2. é–‹æ©Ÿæ™‚ç«‹å³æŒ‰ä½ï¼š`Command + Option + P + R`
3. è½åˆ°å…©æ¬¡å•Ÿå‹•éŸ³å¾Œé¬†é–‹

### 5. æª¢æŸ¥ç³»çµ±æ—¥èªŒ

è©³ç´°çš„ USB æ—¥èªŒï¼š

```bash
# æŒçºŒç›£æ§ USB äº‹ä»¶
sudo log stream --predicate 'process == "kernel" AND (eventMessage CONTAINS "USB" OR eventMessage CONTAINS "HID")' --level debug

# æ’å…¥ Digispark ä¸¦è§€å¯Ÿè¼¸å‡º
```

---

## ğŸ“‹ æ¯”è¼ƒè¡¨ï¼šTrinketHidCombo vs DigiKeyboard

| ç‰¹æ€§ | TrinketHidCombo | DigiKeyboard |
|------|-----------------|--------------|
| macOS ç›¸å®¹æ€§ | âš ï¸ å¯èƒ½æœ‰å•é¡Œ | âœ… å„ªç§€ |
| Windows ç›¸å®¹æ€§ | âœ… å„ªç§€ | âœ… å„ªç§€ |
| Linux ç›¸å®¹æ€§ | âœ… å„ªç§€ | âœ… å„ªç§€ |
| åª’é«”éµæ”¯æ´ | âœ… æ˜¯ | âŒ å¦ |
| æ»‘é¼ æ¨¡æ“¬ | âœ… æ˜¯ | âŒ å¦ |
| ç¨‹å¼ç¢¼å¤§å° | è¼ƒå¤§ | è¼ƒå° |
| ç©©å®šæ€§ | ä¸€èˆ¬ | å„ªç§€ |
| **æ¨è–¦ç”¨æ–¼ macOS** | âŒ | âœ… |

---

## ğŸš€ å¿«é€Ÿè§£æ±ºæ–¹æ¡ˆï¼ˆæœ€æ¨è–¦ï¼‰

```bash
cd ~/Developer/hw-018-keyboard-attack

# ä½¿ç”¨ DigiKeyboard ç‰ˆæœ¬
./build_zipbomb_macos_digi.sh all

# æ’å…¥ Digispark ä¸¦æ¸¬è©¦
```

**å¦‚æœé‚„æ˜¯ç„¡æ³•è­˜åˆ¥ï¼š**

1. æª¢æŸ¥ USB åŸ 
2. å¢åŠ  `setup()` ä¸­çš„ `delay()`
3. é—œé–‰ã€Œå®‰å…¨éµç›¤è¼¸å…¥ã€
4. å˜—è©¦åœ¨ä¸åŒçš„ macOS ç‰ˆæœ¬ä¸Šæ¸¬è©¦

---

## ğŸ“ macOS ç‰ˆæœ¬ç›¸å®¹æ€§

| macOS ç‰ˆæœ¬ | DigiKeyboard | TrinketHidCombo |
|-----------|--------------|-----------------|
| 10.15 Catalina | âœ… | âš ï¸ |
| 11.x Big Sur | âœ… | âš ï¸ |
| 12.x Monterey | âœ… | âŒ |
| 13.x Ventura | âœ… | âŒ |
| 14.x Sonoma | âœ… | âŒ |

**çµè«–ï¼šè¼ƒæ–°çš„ macOS ç‰ˆæœ¬æ‡‰ä½¿ç”¨ DigiKeyboard**

---

## â“ å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼ TrinketHidCombo åœ¨ macOS ä¸Šä¸å·¥ä½œï¼Ÿ
**A:** macOS å° USB HID æè¿°ç¬¦çš„æª¢æŸ¥æ¯”å…¶ä»–ç³»çµ±åš´æ ¼ã€‚TrinketHidCombo çš„è¤‡åˆè£ç½®æè¿°ç¬¦å¯èƒ½ä¸è¢«å®Œå…¨æ”¯æ´ã€‚

### Q: æˆ‘æ‡‰è©²ä½¿ç”¨å“ªå€‹ç‰ˆæœ¬ï¼Ÿ
**A:**
- macOS â†’ ä½¿ç”¨ `zipbomb_macos_digi.ino` (DigiKeyboard)
- Windows/Linux â†’ å…©è€…éƒ½å¯ä»¥ï¼Œä½† DigiKeyboard æ›´ç°¡å–®

### Q: DigiKeyboard æœ‰ä»€éº¼é™åˆ¶å—ï¼Ÿ
**A:** ä¸»è¦é™åˆ¶æ˜¯ä¸æ”¯æ´åª’é«”éµå’Œæ»‘é¼ æ¨¡æ“¬ï¼Œä½†å°æ–¼éµç›¤æ³¨å…¥æ”»æ“Šä¾†èªªå·²ç¶“è¶³å¤ ã€‚

### Q: å¦‚ä½•ç¢ºèªæ˜¯ç¡¬é«”é‚„æ˜¯è»Ÿé«”å•é¡Œï¼Ÿ
**A:**
1. åœ¨ Linux ä¸Šæ¸¬è©¦ï¼ˆLinux å° USB æ›´å¯¬å®¹ï¼‰
2. ä½¿ç”¨å®˜æ–¹ Hello World ç¯„ä¾‹
3. æª¢æŸ¥ LED æ˜¯å¦é–ƒçˆï¼ˆè¡¨ç¤º bootloader æ­£å¸¸ï¼‰

---

## ğŸ“ ç²å–å”åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½ç„¡æ³•è§£æ±ºï¼š

1. ç¢ºèªç¡¬é«”æ­£å¸¸ï¼ˆLED é–ƒçˆï¼‰
2. ç¢ºèª bootloader ç‰ˆæœ¬
3. å˜—è©¦åœ¨ä¸åŒé›»è…¦ä¸Šæ¸¬è©¦
4. åƒè€ƒ Digistump å®˜æ–¹è«–å£‡

---

**æœ€å¾Œæ›´æ–°**: 2025-12-17
**æ¸¬è©¦ç’°å¢ƒ**: macOS 14.x Sonoma
